<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>User Dashboard - Smart Bus Pass</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
      background-color: #121212;
      color: #e0e0e0;
      font-family: 'Segoe UI', sans-serif;
      line-height: 1.6;
    }

    .navbar {
      background-color: #1f1f1f;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.6);
    }

    .navbar .navbar-brand,
    .navbar .btn {
      color: #ffffff;
      transition: color 0.3s ease;
      font-weight: bold;
    }

    .navbar .navbar-brand:hover,
    .navbar .btn:hover {
      color: #0f9ab0;
    }

    h2 {
      color: #ffffff;
      font-weight: 600;
    }

    .card {
      background-color: #1e1e1e;
      border-radius: 14px;
      box-shadow: 0 2px 12px rgba(0, 0, 0, 0.5);
      color: #e0e0e0;
      border: 1px solid #2a2a2a;
      transition: all 0.3s ease-in-out;
    }

    .card:hover {
      transform: translateY(-6px);
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.7);
    }

    .card-header {
      background: linear-gradient(135deg, #0f4c5c, #0c3a47);
      color: #ffffff;
      font-weight: bold;
      font-size: 1.15rem;
      border-bottom: 1px solid #2a2a2a;
    }

    .card-body p,
    .card-body strong,
    .card-body span {
      color: #d0d0d0;
    }

    .badge.bg-success {
      background-color: #1fa67a !important;
    }

    .badge.bg-warning {
      background-color: #ffc107 !important;
      color: #000;
    }

    .badge.bg-secondary {
      background-color: #6c757d !important;
    }

    .btn-primary {
      background: linear-gradient(135deg, #0f4c5c, #0c3a47);
      border: none;
      color: #fff;
      font-weight: 500;
      transition: all 0.3s ease-in-out;
    }

    .btn-primary:hover {
      background: linear-gradient(135deg, #0c3a47, #0f4c5c);
      box-shadow: 0 0 15px rgba(15, 76, 92, 0.6);
      transform: scale(1.03);
    }

    .btn-outline-success {
      border-color: #0f4c5c;
      color: #0f4c5c;
      transition: all 0.3s ease-in-out;
    }

    .btn-outline-success:hover {
      background-color: #0f4c5c;
      color: #ffffff;
      box-shadow: 0 0 12px rgba(15, 76, 92, 0.6);
      transform: scale(1.03);
    }

    .img-fluid {
      max-height: 200px;
      border: 2px solid #0f4c5c;
      border-radius: 12px;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    .img-fluid:hover {
      transform: scale(1.06);
      box-shadow: 0 0 18px rgba(15, 76, 92, 0.7);
    }

    .text-muted {
      color: #b0b0b0 !important;
    }

    .text-warning {
      color: #ffc107 !important;
    }

    .card-body p {
      color: #dcdcdc;
    }

    .card-body strong {
      color: #ffffff;
    }

    /* Toast notifications */
    #toast-container {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 9999;
    }

    .toast {
      background: #4fc3f7;
      color: #000;
      padding: 12px 18px;
      margin-bottom: 10px;
      border-radius: 6px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
      font-size: 14px;
      animation: fadein 0.5s, fadeout 0.5s 4.5s;
    }

    @keyframes fadein {
      from {
        opacity: 0;
      }

      to {
        opacity: 1;
      }
    }

    @keyframes fadeout {
      from {
        opacity: 1;
      }

      to {
        opacity: 0;
      }
    }
  </style>
</head>

<body>

  <nav class="navbar navbar-expand-lg px-4">
    <a class="navbar-brand" href="#">QPass</a>
    <div class="ms-auto">
      <a href="/logout" class="btn btn-outline-light">Logout</a>
    </div>
  </nav>

  <div id="toast-container"></div> <!-- Toast container -->

  <div class="container mt-5">
    <h2 class="mb-4">Welcome, <%= user.username %> ðŸ‘‹</h2>

    <div class="row g-4">
      <!-- Profile Info -->
      <div class="col-md-4">
        <div class="card h-100">
          <div class="card-header">
            Profile Info
          </div>
          <div class="card-body">
            <p><strong>Name:</strong> <%= user.username %></p>
            <p><strong>Email:</strong> <%= user.email %></p>
            <% if (user.phone) { %>
              <p><strong>Phone:</strong> <%= user.phone %></p>
            <% } %>
            <p><strong>Pass Status:</strong>
              <% if (user.passStatus==='approved') { %>
                <span class="badge bg-success">Approved</span>
              <% } else if (user.passStatus==='manual_review') { %>
                <span class="badge bg-warning text-dark">Under Review</span>
              <% } else { %>
                <span class="badge bg-secondary">Not Applied</span>
              <% } %>
            </p>
          </div>
        </div>
      </div>

      <!-- Pass Info -->
      <div class="col-md-4">
        <div class="card h-100">
          <div class="card-header">
            Bus Pass Info
          </div>
          <div class="card-body">
            <% if (user.passStatus==='approved' && user.passDetails) { %>
              <p><strong>From:</strong> <%= user.passDetails.from %></p>
              <p><strong>To:</strong> <%= user.passDetails.to %></p>
              <p><strong>Duration:</strong> <%= user.passDetails.duration %></p>
              <p><strong>Valid Until:</strong> <%= user.passDetails.validTill %></p>
            <% } else { %>
              <p class="text-muted">No active pass found.</p>
            <% } %>
          </div>
        </div>
      </div>

      <!-- QR Code -->
      <div class="col-md-4">
        <div class="card h-100">
          <div class="card-header">
            QR Code
          </div>
          <div class="card-body text-center">
            <% if (user.passStatus==='approved' && user.qrData) { %>
              <img src="<%= user.qrData %>" alt="QR Code" class="img-fluid" />
              <a href="<%= user.qrData %>" download class="btn btn-outline-success mt-3">Download QR</a>
            <% } else if (user.passStatus==='manual_review') { %>
              <p class="text-warning">Your ID is under admin review. Please wait for approval.</p>
            <% } else { %>
              <p class="text-muted">No QR available yet.</p>
            <% } %>
          </div>
        </div>
      </div>
    </div>

    <!-- Apply or Renew Button -->
    <div class="text-center mt-5">
      <a href="/apply-pass" class="btn btn-primary btn-lg">
        <% if (user.passStatus==='approved') { %>
          Renew Pass
        <% } else { %>
          Apply for Bus Pass
        <% } %>
      </a>
    </div>
  </div>

  <script>
    // Toast Notification Function
    function showToast(message) {
      const container = document.getElementById('toast-container');
      const toast = document.createElement('div');
      toast.classList.add('toast');
      toast.textContent = message;
      container.appendChild(toast);
      setTimeout(() => toast.remove(), 5000);
    }

   fetch('/user/notifications')
  .then(res => res.json())
  .then(data => {
    data.forEach(n => showToast(n.message));
  });

  </script>

</body>

</html>
